[æ ¹ç›®å½•](../../CLAUDE.md) > [src](../) > **database**

# æ•°æ®åº“æ“ä½œæ¨¡å—

## ğŸ¯ æ¨¡å—èŒè´£

æ•°æ®åº“æ“ä½œæ¨¡å—æ˜¯ç³»ç»Ÿçš„**æ•°æ®ä¸­æ¢**ï¼Œè´Ÿè´£ï¼š
- æ•°æ®æŒä¹…åŒ–å­˜å‚¨ä¸æŸ¥è¯¢ï¼ˆäº¤æ˜“è®°å½•ã€æŒä»“ã€è´¦æˆ·å†å²ï¼‰
- ä¸Gate.io APIæ•°æ®åŒæ­¥ï¼ˆæŒä»“ã€è®¢å•çŠ¶æ€ï¼‰
- æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ä¸ä¿®å¤
- æ•°æ®åº“åˆå§‹åŒ–ã€è¿ç§»ä¸é‡ç½®

## ğŸš€ å…¥å£ä¸å¯åŠ¨

**ä¸»å…¥å£**: `init.ts` (ç³»ç»Ÿå¯åŠ¨æ—¶è°ƒç”¨)

```typescript
// ç³»ç»Ÿå¯åŠ¨æµç¨‹
await initDatabase();        // åˆå§‹åŒ–æ•°æ®åº“
await initTradingSystem();   // åŒæ­¥äº¤æ˜“é…ç½®
```

**å…³é”®è„šæœ¬å…¥å£**:
- `init.ts` - æ•°æ®åº“åˆå§‹åŒ–
- `reset.ts` - æ•°æ®åº“é‡ç½®  
- `sync-from-gate.ts` - Gate.ioæ•°æ®åŒæ­¥
- `close-and-reset.ts` - å¹³ä»“å¹¶é‡ç½®

## ğŸ”Œ å¯¹å¤–æ¥å£

### æ•°æ®åº“åˆå§‹åŒ–æ¥å£

| å‡½æ•° | ç”¨é€” | å‚æ•° | è¿”å› |
|-----|------|------|------|
| `initDatabase()` | åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„ | æ—  | Promise<void> |
| `resetDatabase()` | é‡ç½®æ•°æ®åº“ï¼ˆæ¸…ç©ºæ•°æ®ï¼‰ | æ—  | Promise<void> |
| `checkDatabaseConsistency()` | æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§ | æ—  | Promise<ConsistencyReport> |

### æ•°æ®åŒæ­¥æ¥å£

| å‡½æ•° | ç”¨é€” | å‚æ•° | è¿”å› |
|-----|------|------|------|
| `syncPositionsFromGate()` | åŒæ­¥æŒä»“æ•°æ® | gateClient | Promise<SyncResult> |
| `syncTradesFromGate()` | åŒæ­¥äº¤æ˜“è®°å½• | gateClient | Promise<SyncResult> |
| `closeAllPositions()` | å¹³ä»“æ‰€æœ‰æŒä»“ | gateClient | Promise<CloseResult> |

## ğŸ› ï¸ å…³é”®ä¾èµ–ä¸é…ç½®

### æ ¸å¿ƒä¾èµ–
```json
{
  "@libsql/client": "^0.x",          // LibSQLæ•°æ®åº“å®¢æˆ·ç«¯
  "gate-api": "^6.61.0",             // Gate.io APIå®¢æˆ·ç«¯
  "@voltagent/logger": "^1.0.0"      // æ—¥å¿—ç³»ç»Ÿ
}
```

### æ•°æ®åº“é…ç½®
```typescript
// æ•°æ®åº“è¿æ¥é…ç½®
const dbClient = createClient({
  url: process.env.DATABASE_URL || "file:./.voltagent/trading.db",
});
```

### ç¯å¢ƒå˜é‡
```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=file:./.voltagent/trading.db

# Gate.ioåŒæ­¥é…ç½®
GATE_API_KEY=your_api_key
GATE_API_SECRET=your_api_secret
GATE_USE_TESTNET=false
```

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### 1. äº¤æ˜“è®°å½•è¡¨ (trades)
```typescript
interface Trade {
  id: number;                // ä¸»é”®
  order_id: string;          // Gate.ioè®¢å•ID
  symbol: string;            // äº¤æ˜“å¯¹ (BTC/USDT)
  side: 'long' | 'short';    // äº¤æ˜“æ–¹å‘
  type: 'open' | 'close';    // å¼€ä»“/å¹³ä»“
  price: number;             // æˆäº¤ä»·æ ¼
  quantity: number;          // æˆäº¤æ•°é‡
  leverage: number;          // æ æ†å€æ•°
  pnl?: number;              // ç›ˆäºé‡‘é¢
  fee?: number;              // æ‰‹ç»­è´¹
  timestamp: string;         // æˆäº¤æ—¶é—´
  status: 'pending' | 'filled' | 'cancelled'; // è®¢å•çŠ¶æ€
}
```

#### 2. æŒä»“è¡¨ (positions)
```typescript
interface Position {
  id: number;                // ä¸»é”®
  symbol: string;            // äº¤æ˜“å¯¹ (å”¯ä¸€çº¦æŸ)
  quantity: number;          // æŒä»“æ•°é‡
  entry_price: number;       // å¼€ä»“ä»·æ ¼
  current_price: number;     // å½“å‰ä»·æ ¼
  liquidation_price: number; // å¼ºå¹³ä»·æ ¼
  unrealized_pnl: number;    // æœªå®ç°ç›ˆäº
  leverage: number;          // æ æ†å€æ•°
  side: 'long' | 'short';    // æŒä»“æ–¹å‘
  profit_target?: number;    // æ­¢ç›ˆä»·æ ¼
  stop_loss?: number;        // æ­¢æŸä»·æ ¼
  tp_order_id?: string;      // æ­¢ç›ˆè®¢å•ID
  sl_order_id?: string;      // æ­¢æŸè®¢å•ID
  entry_order_id: string;    // å¼€ä»“è®¢å•ID
  opened_at: string;         // å¼€ä»“æ—¶é—´
  confidence?: number;       // AIä¿¡å¿ƒåº¦
  risk_usd?: number;         // é£é™©é‡‘é¢(USD)
  peak_pnl_percent?: number; // å†å²æœ€é«˜ç›ˆäºç™¾åˆ†æ¯”
}
```

#### 3. è´¦æˆ·å†å²è¡¨ (account_history)
```typescript
interface AccountHistory {
  id: number;                // ä¸»é”®
  timestamp: string;         // è®°å½•æ—¶é—´
  total_value: number;       // æ€»èµ„äº§ä»·å€¼
  available_cash: number;    // å¯ç”¨èµ„é‡‘
  unrealized_pnl: number;    // æœªå®ç°ç›ˆäº
  realized_pnl: number;      // å·²å®ç°ç›ˆäº
  return_percent: number;    // æ”¶ç›Šç‡ç™¾åˆ†æ¯”
  sharpe_ratio?: number;     // å¤æ™®æ¯”ç‡
}
```

#### 4. æŠ€æœ¯æŒ‡æ ‡è¡¨ (trading_signals)
```typescript
interface TradingSignal {
  id: number;                // ä¸»é”®
  symbol: string;            // äº¤æ˜“å¯¹
  timestamp: string;         // ä¿¡å·æ—¶é—´
  price: number;             // å½“å‰ä»·æ ¼
  ema_20: number;            // 20å‘¨æœŸEMA
  ema_50?: number;           // 50å‘¨æœŸEMA
  macd: number;              // MACDå€¼
  rsi_7: number;             // 7å‘¨æœŸRSI
  rsi_14: number;            // 14å‘¨æœŸRSI
  volume: number;            // æˆäº¤é‡
  open_interest?: number;    // æœªå¹³ä»“åˆçº¦
  funding_rate?: number;     // èµ„é‡‘è´¹ç‡
  atr_3?: number;            // 3å‘¨æœŸATR
  atr_14?: number;           // 14å‘¨æœŸATR
}
```

#### 5. AIå†³ç­–è®°å½•è¡¨ (agent_decisions)
```typescript
interface AgentDecision {
  id: number;                // ä¸»é”®
  timestamp: string;         // å†³ç­–æ—¶é—´
  iteration: number;         // è¿­ä»£æ¬¡æ•°
  market_analysis: string;   // å¸‚åœºåˆ†æ
  decision: string;          // å…·ä½“å†³ç­–(JSON)
  actions_taken: string;     // æ‰§è¡ŒåŠ¨ä½œ
  account_value: number;     // è´¦æˆ·ä»·å€¼
  positions_count: number;   // æŒä»“æ•°é‡
}
```

#### 6. ç³»ç»Ÿé…ç½®è¡¨ (system_config)
```typescript
interface SystemConfig {
  id: number;                // ä¸»é”®
  key: string;               // é…ç½®é”® (å”¯ä¸€)
  value: string;             // é…ç½®å€¼
  updated_at: string;        // æ›´æ–°æ—¶é—´
}
```

## ğŸ”„ æ•°æ®åŒæ­¥ç­–ç•¥

### åŒæ­¥æ—¶æœº
1. **ç³»ç»Ÿå¯åŠ¨æ—¶**: å…¨é‡åŒæ­¥æŒä»“å’Œè®¢å•çŠ¶æ€
2. **äº¤æ˜“å¾ªç¯å‰**: åŒæ­¥æœ€æ–°ä»·æ ¼å’ŒæŒä»“ä¿¡æ¯
3. **å¼‚å¸¸æ¢å¤æ—¶**: æ£€æŸ¥å¹¶ä¿®å¤æ•°æ®ä¸ä¸€è‡´
4. **å®šæ—¶åŒæ­¥**: æ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡å®Œæ•´æ€§æ£€æŸ¥

### åŒæ­¥æµç¨‹
```
å¼€å§‹åŒæ­¥
    â†“
è·å–Gate.ioæ•°æ®
    â†“
å¯¹æ¯”æœ¬åœ°æ•°æ®
    â†“
å‘ç°å·®å¼‚ï¼Ÿ â†’ æ˜¯ â†’ æ›´æ–°æœ¬åœ°æ•°æ®
    â†“å¦
åŒæ­¥å®Œæˆ
```

### å†²çªè§£å†³ç­–ç•¥
- **ä»·æ ¼å†²çª**: ä»¥Gate.ioå®æ—¶ä»·æ ¼ä¸ºå‡†
- **æŒä»“å†²çª**: ä»¥Gate.ioå®é™…æŒä»“ä¸ºå‡†
- **è®¢å•å†²çª**: ä»¥Gate.ioè®¢å•çŠ¶æ€ä¸ºå‡†
- **æ—¶é—´å†²çª**: ä»¥Gate.ioæœåŠ¡å™¨æ—¶é—´ä¸ºå‡†

## ğŸ§ª æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

### æ£€æŸ¥é¡¹ç›®
1. **æŒä»“ä¸€è‡´æ€§**: æœ¬åœ°æŒä»“ vs Gate.ioæŒä»“
2. **è®¢å•çŠ¶æ€**: æœ¬åœ°è®¢å•çŠ¶æ€ vs å®é™…çŠ¶æ€
3. **ä»·æ ¼ä¸€è‡´æ€§**: æœ¬åœ°ç¼“å­˜ä»·æ ¼ vs å®æ—¶ä»·æ ¼
4. **è´¦æˆ·ä½™é¢**: æœ¬åœ°è®¡ç®— vs Gate.ioè´¦æˆ·
5. **ç›ˆäºè®¡ç®—**: æœ¬åœ°è®¡ç®— vs å®é™…ç›ˆäº

### ä¿®å¤æœºåˆ¶
```typescript
interface ConsistencyCheck {
  positionsMatch: boolean;      // æŒä»“æ˜¯å¦ä¸€è‡´
  ordersMatch: boolean;         // è®¢å•æ˜¯å¦ä¸€è‡´
  pricesMatch: boolean;         // ä»·æ ¼æ˜¯å¦ä¸€è‡´
  balanceMatch: boolean;        // ä½™é¢æ˜¯å¦ä¸€è‡´
  issuesFound: string[];        // å‘ç°çš„é—®é¢˜åˆ—è¡¨
  repairsMade: string[];        // æ‰§è¡Œçš„ä¿®å¤æ“ä½œ
}
```

## ğŸ” å¸¸è§é—®é¢˜ (FAQ)

### Q: æ•°æ®åº“æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
**A**: é»˜è®¤ä½ç½® `./.voltagent/trading.db`ï¼Œå¯é€šè¿‡ `DATABASE_URL` ç¯å¢ƒå˜é‡ä¿®æ”¹è·¯å¾„ã€‚

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®åº“ï¼Ÿ
**A**: ç›´æ¥å¤åˆ¶ `.voltagent/trading.db` æ–‡ä»¶å³å¯ï¼ŒSQLiteæ”¯æŒçƒ­å¤‡ä»½ã€‚

### Q: æ•°æ®åŒæ­¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A**: æ£€æŸ¥æ­¥éª¤ï¼š1) APIå¯†é’¥æ˜¯å¦æ­£ç¡® 2) ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ 3) Gate.ioæœåŠ¡çŠ¶æ€ 4) æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### Q: å¦‚ä½•é‡ç½®æ‰€æœ‰æ•°æ®ï¼Ÿ
**A**: æ‰§è¡Œ `npm run db:reset` ä¼šæ¸…ç©ºæ‰€æœ‰æ•°æ®å¹¶é‡æ–°åˆå§‹åŒ–è¡¨ç»“æ„ã€‚

### Q: æ•°æ®åº“æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ
**A**: ä¼˜åŒ–æªæ–½ï¼š1) æ·»åŠ é€‚å½“ç´¢å¼• 2) å®šæœŸVACUUM 3) é™åˆ¶å†å²æ•°æ®ä¿ç•™æœŸ 4) ä½¿ç”¨WALæ¨¡å¼

## ğŸ“‹ ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `schema.ts` - æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰
- `init.ts` - æ•°æ®åº“åˆå§‹åŒ–
- `reset.ts` - æ•°æ®åº“é‡ç½®
- `sync-from-gate.ts` - Gate.ioæ•°æ®åŒæ­¥
- `close-and-reset.ts` - å¹³ä»“å¹¶é‡ç½®

### è¾…åŠ©æ–‡ä»¶
- `check-trades.ts` - äº¤æ˜“è®°å½•æ£€æŸ¥
- `add-fee-column.ts` - æ·»åŠ æ‰‹ç»­è´¹å­—æ®µ
- `add-peak-pnl-column.ts` - æ·»åŠ å³°å€¼ç›ˆäºå­—æ®µ

### é…ç½®æ–‡ä»¶
- `../../.env` - æ•°æ®åº“è¿æ¥é…ç½®
- `../config/riskParams.ts` - é£é™©å‚æ•° (è¢«æ•°æ®æ¨¡å—ä½¿ç”¨)

## ğŸ“ å˜æ›´è®°å½•

### 2025-10-30 åˆå§‹ç‰ˆæœ¬
- **æ–°å¢**: æ•°æ®åº“æ“ä½œæ¨¡å—æ–‡æ¡£
- **æ–°å¢**: æ•°æ®æ¨¡å‹è¯¦ç»†è®¾è®¡
- **æ–°å¢**: åŒæ­¥ç­–ç•¥ä¸å®Œæ•´æ€§æ£€æŸ¥
- **æ–°å¢**: å¸¸è§é—®é¢˜ä¸æ€§èƒ½ä¼˜åŒ–

---

**æ¨¡å—çŠ¶æ€**: âœ… æ´»è·ƒå¼€å‘  
**ç»´æŠ¤è€…**: AI Trading System  
**æ›´æ–°æ—¶é—´**: 2025-10-30 11:29:10

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

1. **æ€§èƒ½ä¼˜åŒ–**: æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢æ€§èƒ½æå‡
2. **æ•°æ®å½’æ¡£**: å†å²æ•°æ®è‡ªåŠ¨å½’æ¡£ä¸å‹ç¼©
3. **å¤‡ä»½æœºåˆ¶**: è‡ªåŠ¨å¤‡ä»½ä¸æ¢å¤ç­–ç•¥
4. **ç›‘æ§å‘Šè­¦**: æ•°æ®åº“æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦
5. **æ•°æ®å¯è§†åŒ–**: å†…ç½®å›¾è¡¨ä¸æŠ¥è¡¨åŠŸèƒ½

**é¢„è®¡å¼€å‘å‘¨æœŸ**: 1-2å‘¨
**ä¼˜å…ˆçº§**: é«˜ (æ€§èƒ½) â†’ ä¸­ (å¤‡ä»½) â†’ ä½ (å¯è§†åŒ–)

---

**æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡**:
- æŸ¥è¯¢å“åº”æ—¶é—´: â‰¤100ms (å•è¡¨)
- å¹¶å‘å¤„ç†èƒ½åŠ›: â‰¥100 QPS
- å­˜å‚¨ç©ºé—´: â‰¤1GB (1å¹´æ•°æ®)
- å¤‡ä»½æ—¶é—´: â‰¤5åˆ†é’Ÿ

**æ•°æ®è´¨é‡æŒ‡æ ‡**:
- æ•°æ®ä¸€è‡´æ€§: â‰¥99.9%
- åŒæ­¥æˆåŠŸç‡: â‰¥99.5%
- æ•°æ®å®Œæ•´æ€§: 100%
- é”™è¯¯æ¢å¤æ—¶é—´: â‰¤1åˆ†é’Ÿ

**è¿ç»´ç›‘æ§**:
```bash
# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
npm run db:status

# æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
npm run db:check-consistency

# æ‰‹åŠ¨åŒæ­¥æ•°æ®
npm run db:sync

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
du -h .voltagent/trading.db
```

**æ•°æ®åº“ç»´æŠ¤è„šæœ¬**:
```bash
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬
BACKUP_DIR="./backups"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR
cp .voltagent/trading.db $BACKUP_DIR/trading_$DATE.db

# æ¸…ç†7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.db" -mtime +7 -delete
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**:
```sql
-- æ·»åŠ å¤åˆç´¢å¼•æé«˜æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_trades_symbol_timestamp ON trades(symbol, timestamp);
CREATE INDEX idx_positions_side_symbol ON positions(side, symbol);
CREATE INDEX idx_signals_symbol_time ON trading_signals(symbol, timestamp);

-- ä½¿ç”¨WALæ¨¡å¼æé«˜å¹¶å‘æ€§èƒ½
PRAGMA journal_mode=WAL;
PRAGMA synchronous=NORMAL;

-- å®šæœŸä¼˜åŒ–æ•°æ®åº“
VACUUM;
PRAGMA optimize;
```

**æ•°æ®ä¿ç•™ç­–ç•¥**:
- äº¤æ˜“è®°å½•: æ°¸ä¹…ä¿ç•™
- è´¦æˆ·å†å²: ä¿ç•™2å¹´
- æŠ€æœ¯æŒ‡æ ‡: ä¿ç•™6ä¸ªæœˆ
- AIå†³ç­–è®°å½•: ä¿ç•™1å¹´
- ç³»ç»Ÿæ—¥å¿—: ä¿ç•™3ä¸ªæœˆ

**æ‰©å±•æ€§è€ƒè™‘**:
- æ”¯æŒåˆ†åº“åˆ†è¡¨ (æœªæ¥)
- æ”¯æŒè¯»å†™åˆ†ç¦» (æœªæ¥)
- æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½² (æœªæ¥)
- æ”¯æŒå®æ—¶å¤‡ä»½ (æœªæ¥)

**å®‰å…¨è€ƒè™‘**:
- æ•°æ®åº“æ–‡ä»¶æƒé™æ§åˆ¶
- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- è®¿é—®æ—¥å¿—è®°å½•
- å¼‚å¸¸æ“ä½œç›‘æ§

---

**æ•°æ®åº“æ¶æ„å›¾**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº¤æ˜“ä»£ç†       â”‚    â”‚   æ•°æ®åº“æ¨¡å—     â”‚    â”‚   Gate.io API  â”‚
â”‚  (AIå†³ç­–)       â”‚â—„â”€â”€â–ºâ”‚  (LibSQL)       â”‚â—„â”€â”€â–ºâ”‚  (å¤–éƒ¨æ•°æ®)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚                       â”‚
       â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº¤æ˜“å·¥å…·       â”‚    â”‚   æ•°æ®å®Œæ•´æ€§     â”‚    â”‚   å®æ—¶ç›‘æ§     â”‚
â”‚  (æ‰§è¡Œå±‚)       â”‚    â”‚  (æ£€æŸ¥ä¿®å¤)     â”‚    â”‚  (åŒæ­¥éªŒè¯)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®ç”Ÿå‘½å‘¨æœŸ**:
```
æ•°æ®äº§ç”Ÿ â†’ æœ¬åœ°å­˜å‚¨ â†’ åŒæ­¥éªŒè¯ â†’ å®Œæ•´æ€§æ£€æŸ¥ â†’ å½’æ¡£å¤‡ä»½ â†’ æ¸…ç†åˆ é™¤
    â”‚         â”‚         â”‚           â”‚           â”‚         â”‚
äº¤æ˜“è®°å½•    æ•°æ®åº“    Gate.io     å®šæ—¶ä»»åŠ¡     å†å²æ•°æ®   è¿‡æœŸæ¸…ç†
AIå†³ç­–      ç´¢å¼•      å¯¹æ¯”        è‡ªåŠ¨ä¿®å¤     å‹ç¼©å­˜å‚¨   ç©ºé—´å›æ”¶
```

**æ•…éšœæ¢å¤**:
- æ•°æ®æŸå: ä»å¤‡ä»½æ¢å¤
- åŒæ­¥å¤±è´¥: æ‰‹åŠ¨é‡æ–°åŒæ­¥
- æ€§èƒ½ä¸‹é™: é‡å»ºç´¢å¼•+ä¼˜åŒ–
- ç©ºé—´ä¸è¶³: æ¸…ç†å†å²æ•°æ®

---

**æœ€ä½³å®è·µ**:
1. **å®šæœŸå¤‡ä»½**: æ¯æ—¥è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
2. **ç›‘æ§å‘Šè­¦**: å®æ—¶ç›‘æ§æ•°æ®åº“æ€§èƒ½
3. **æ•°æ®éªŒè¯**: å®šæœŸæ£€æŸ¥æ•°æ®å®Œæ•´æ€§
4. **æ€§èƒ½ä¼˜åŒ–**: å®šæœŸé‡å»ºç´¢å¼•å’Œä¼˜åŒ–
5. **å®¹é‡è§„åˆ’**: é¢„ä¼°æ•°æ®å¢é•¿å’Œå­˜å‚¨éœ€æ±‚
6. **æ–‡æ¡£ç»´æŠ¤**: ä¿æŒæ•°æ®æ¨¡å‹æ–‡æ¡£æ›´æ–°

**å¸¸è§é”™è¯¯å¤„ç†**:
```typescript
// æ•°æ®åº“é”å®šé”™è¯¯
try {
  await dbClient.execute(sql);
} catch (error) {
  if (error.code === 'SQLITE_BUSY') {
    // ç­‰å¾…é‡è¯•
    await sleep(100);
    return retry();
  }
  throw error;
}

// æ•°æ®ä¸€è‡´æ€§é”™è¯¯
if (!positionsMatch) {
  logger.warn('æŒä»“æ•°æ®ä¸ä¸€è‡´ï¼Œæ‰§è¡Œä¿®å¤');
  await repairPositions();
}
```

**æ•°æ®è¿ç§»ç­–ç•¥**:
- ç‰ˆæœ¬æ§åˆ¶: ä½¿ç”¨è¿ç§»è„šæœ¬ç®¡ç†ç‰ˆæœ¬
- å›æ»šæœºåˆ¶: æ”¯æŒå›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
- å…¼å®¹æ€§: ä¿æŒå‘åå…¼å®¹æ€§
- æµ‹è¯•éªŒè¯: è¿ç§»å‰å……åˆ†æµ‹è¯•
- å¤‡ä»½æ¢å¤: è¿ç§»å‰å®Œæ•´å¤‡ä»½

---

**æ€»ç»“**: æ•°æ®åº“æ¨¡å—æ˜¯æ•´ä¸ªäº¤æ˜“ç³»ç»Ÿçš„æ•°æ®åŸºç¡€ï¼Œå…¶ç¨³å®šæ€§ã€å®Œæ•´æ€§å’Œæ€§èƒ½ç›´æ¥å½±å“äº¤æ˜“å†³ç­–çš„å‡†ç¡®æ€§å’Œç³»ç»Ÿçš„å¯é æ€§ã€‚é€šè¿‡åˆç†çš„æ•°æ®æ¨¡å‹è®¾è®¡ã€å®Œå–„çš„åŒæ­¥æœºåˆ¶å’Œä¸¥æ ¼çš„å®Œæ•´æ€§æ£€æŸ¥ï¼Œç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ï¼Œä¸ºAIäº¤æ˜“ä»£ç†æä¾›å¯é çš„æ•°æ®æ”¯æŒã€‚åŒæ—¶ï¼Œé€šè¿‡æ€§èƒ½ä¼˜åŒ–ã€ç›‘æ§å‘Šè­¦å’Œæ•…éšœæ¢å¤æœºåˆ¶ï¼Œä¿éšœç³»ç»Ÿåœ¨é«˜å¹¶å‘å’Œå¤§æ•°æ®é‡åœºæ™¯ä¸‹çš„ç¨³å®šè¿è¡Œã€‚æŒç»­çš„æ•°æ®è´¨é‡ç›‘æ§å’Œä¼˜åŒ–æ˜¯ä¿æŒç³»ç»Ÿå¥åº·è¿è¡Œçš„å…³é”®ã€‚`